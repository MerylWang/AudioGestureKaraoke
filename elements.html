<html class="gr__musicazoo_mit_edu">

<head>
    <!-- Google Tag Manager -->
    <script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-N6WTLHM"></script>
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-N6WTLHM');
    </script>
    <!-- End Google Tag Manager -->
    <style id="stndz-style"></style>
    <title>Musicazoo WIP</title>
    <style>
        body {
            color: #f3fde1;
            background-color: #406873;
        }
    </style>
</head>

<body data-gr-c-s-loaded="true" style="">
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WTLHM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    <h1>Musicazoo</h1>
    <p id="nowplaying" style="">Now Playing: <span id="playingtitle">You &amp; Me</span> <span id="playingtime">0:17</span>/<span id="playinglength">2:52</span> <span id="paused" style="display: none;">[Paused]</span></p>
    <p>Volume:
        <button id="sub">-</button><span id="vol">50</span>
        <button id="add">+</button>
    </p>
    <p>
        <button id="pause">play/pause</button>
    </p>
    <p>Use this form to queue new videos:</p>
    <input type="text" id="youtube_id" placeholder="youtube search or ID">
    <button id="submit">Queue</button>
    <button id="suggest">Search</button>
    <button id="random">Random</button>
    <ul id="suggestions"></ul>
    <p>Queued items:</p>
    <ul id="queue">
        <li><span>You &amp; Me</span> |
            <button>delete</button> |
            <button style="display: none;">up</button>
            <button style="display: none;">down</button>
        </li>
    </ul>
    <script>
        (function() {
            function json_request(cb, err, endpoint) {
                var req = new XMLHttpRequest();
                req.addEventListener("load", function() {
                    var json = JSON.parse(this.responseText);
                    if (json) {
                        cb(json);
                    } else {
                        err("bad json from endpoint " + endpoint);
                    }
                });
                req.addEventListener("error", function() {
                    err("xhr failed");
                });
                req.open("POST", endpoint, true);
                req.send();
            }

            function default_err(err) {
                console.log("error", err);
            }

            function left_pad(s, padchar, minlength) {
                if (s.length < minlength) {
                    return (padchar * (minlength - s.length)) + s;
                } else {
                    return s;
                }
            }

            function secs_to_hms(secs) {
                var hours = Math.floor(secs / 3600);
                var minutes = Math.floor((secs % 3600) / 60);
                var seconds = Math.floor(secs % 60);
                if (hours > 0) {
                    return hours.toString() + ":" + left_pad(minutes.toString(), "0", 2) + ":" + left_pad(seconds.toString(), "0", 2);
                } else {
                    return minutes.toString() + ":" + left_pad(seconds.toString(), "0", 2);
                }
            }
            var nowplaying = document.getElementById("nowplaying");
            var playingtitle = document.getElementById("playingtitle");
            var playingtime = document.getElementById("playingtime");
            var playinglength = document.getElementById("playinglength");
            var paused = document.getElementById("paused");
            var youtube_id = document.getElementById("youtube_id");
            var submit = document.getElementById("submit");
            var queue = document.getElementById("queue");
            var suggestions = document.getElementById("suggestions");
            var suggest = document.getElementById("suggest");
            var add = document.getElementById("add");
            var sub = document.getElementById("sub");
            var vol = document.getElementById("vol");
            var pausebtn = document.getElementById("pause");
            var random = document.getElementById("random");

            function clear_suggestions() {
                suggestions.innerHTML = "";
            }
            var current_volume = null;

            function set_volume(vol) {
                current_volume = vol;
                json_request(function() {}, default_err, "setvolume?vol=" + vol);
                return current_volume;
            };
            add.onclick = function() {
                if (current_volume !== null) {
                    set_volume(current_volume + 5);
                }
            };
            sub.onclick = function() {
                if (current_volume !== null) {
                    set_volume(current_volume - 5);
                }
            };
            random.onclick = function() {
                if (random.disabled) {
                    return;
                }
                random.disabled = true;
                json_request(function() {
                    random.disabled = false;
                }, function(err) {
                    random.disabled = false;
                    console.log(err);
                }, "random");
            };

            function reorder(uuid, direction) {
                json_request(function() {}, default_err, "reorder?uuid=" + encodeURIComponent(uuid) + "&dir=" + encodeURIComponent("" + direction));
            };
            pausebtn.onclick = function() {
                json_request(function() {}, default_err, "pause");
            };

            function render_suggestions(results) {
                var outline = "";
                for (var i = 0; i < results.length; i++) {
                    outline += "<li><span></span><button>queue</button><button>up</button><button>down</button></li>";
                }
                suggestions.innerHTML = outline;
                for (var i = 0; i < results.length; i++) {
                    suggestions.children[i].children[0].textContent = results[i].title;
                    suggestions.children[i].children[1].onclick = function() {
                        youtube_id.value = this;
                        suggestions.innerHTML = "";
                        submit.onclick();
                    }.bind(results[i].ytid);
                }
            }
            suggest.onclick = function() {
                if (suggest.disabled) {
                    return;
                }
                suggest.disabled = true;
                json_request(function(data) {
                    render_suggestions(data);
                    suggest.disabled = false;
                }, function(err) {
                    console.log(err);
                    suggest.disabled = false;
                }, "search?q=" + encodeURIComponent(youtube_id.value));
            };
            youtube_id.onkeypress = function(e) {
                if (!e) {
                    e = window.event;
                }
                clear_suggestions();
                var keyCode = e.keyCode || e.which;
                if (keyCode == 13) {
                    submit.onclick();
                    return false;
                }
            };
            submit.onclick = function() {
                if (youtube_id.disabled) {
                    return;
                }
                youtube_id.disabled = true;
                json_request(function(data) {
                    youtube_id.value = "";
                    youtube_id.disabled = false;
                }, function(err) {
                    console.log(err);
                    youtube_id.disabled = false;
                }, "enqueue?youtube_id=" + encodeURIComponent(youtube_id.value));
            };

            function delete_uuid(x) {
                json_request(function(data) {}, default_err, "delete?uuid=" + encodeURIComponent(x));
            }

            function refresh() {
                json_request(function(data) {
                    if (data.listing.length > 0 && data.loaded[data.listing[0].ytid]) {
                        playingtitle.textContent = data.titles[data.listing[0].ytid];
                        playingtime.textContent = secs_to_hms(data.time);
                        playinglength.textContent = secs_to_hms(data.length);
                        if (data.paused) {
                            paused.style.display = "";
                        } else {
                            paused.style.display = "none";
                        }
                        nowplaying.style.display = "";
                        pausebtn.disabled = false
                    } else {
                        nowplaying.style.display = "none";
                        pausebtn.disabled = true
                    }
                    current_volume = data.volume;
                    vol.textContent = current_volume !== null ? current_volume : "loading";
                    var total = "";
                    for (var i = 0; i < data.listing.length; i++) {
                        total += "<li><span></span> | <button>delete</button> | <button>up</button> <button>down</button></li>";
                    }
                    queue.innerHTML = total;
                    for (var i = 0; i < data.listing.length; i++) {
                        var span = queue.children[i].children[0];
                        var deleter = queue.children[i].children[1];
                        var up = queue.children[i].children[2];
                        var down = queue.children[i].children[3];
                        var ytid = data.listing[i].ytid;
                        var title = data.titles[ytid] || ytid;
                        if (!data.titles[ytid] || !data.loaded[ytid]) {
                            title += " (loading)";
                        }
                        span.innerText = title;
                        deleter.onclick = (function() {
                            delete_uuid(this);
                        }).bind(data.listing[i].uuid);
                        if (i == 0) {
                            up.style.display = "none";
                        }
                        up.onclick = function() {
                            reorder(this, -1);
                        }.bind(data.listing[i].uuid);
                        if (i == data.listing.length - 1) {
                            down.style.display = "none";
                        }
                        down.onclick = function() {
                            reorder(this, +1);
                        }.bind(data.listing[i].uuid);
                    }
                }, default_err, "status");
            };
            setInterval(refresh, 1000);
        })();
    </script>

    <div class="liner-mini-button" style="display: none;">
        <a class="liner-mb liner-save-button"></a>
    </div>
    <div class="liner-mini-tooltip" style="display: none;"><span class="liner-color-yellow liner-mini-color-circle liner-save-button"></span><span class="liner-color-green liner-mini-color-circle liner-save-button"></span><span class="liner-color-orange liner-mini-color-circle liner-save-button"></span><span class="liner-color-violet liner-mini-color-circle liner-save-button"></span><span class="liner-color-blue liner-mini-color-circle liner-save-button"></span><span class="liner-color-pink liner-mini-color-circle liner-save-button"></span></div>
    <div class="liner-tooltip-wrap">
        <div class="liner-tooltip-menu"><span class="liner-tooltip-color liner-tooltip-icon"></span><span class="liner-tooltip-comment liner-tooltip-icon"></span><span class="liner-tooltip-undo liner-tooltip-icon"></span></div>
        <div class="liner-color-picker"><span class="liner-color-yellow liner-color-circle"></span><span class="liner-color-green liner-color-circle"></span><span class="liner-color-orange liner-color-circle"></span><span class="liner-color-violet liner-color-circle"></span><span class="liner-color-blue liner-color-circle"></span><span class="liner-color-pink liner-color-circle"></span></div>
        <div class="liner-tooltip-arrow"><span class="liner-arrow-down"></span></div>
    </div>
    <div class="liner-comment-box">
        <div class="liner-comment-line"></div>
        <div class="liner-comment-area">
            <textarea class="liner-comment-input" placeholder="Write a comment"></textarea>
            <div class="liner-comment-saving">
                <p class="liner-comment-status"></p>
            </div>
        </div>
    </div>
    <iframe name="liner-extension" id="liner-extension" src="chrome-extension://bmhcbmnbenmcecpmpepghooflbehcack/scripts/popup.html" style="opacity: 0; top: -130px;"></iframe>
</body>

</html>
